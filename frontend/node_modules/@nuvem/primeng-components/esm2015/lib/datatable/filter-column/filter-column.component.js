import { Component, EventEmitter, Output, Input } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '@angular/forms';
import * as ɵngcc3 from 'primeng/inputtext';
import * as ɵngcc4 from 'primeng/multiselect';

const _c0 = function () { return { width: "100%" }; };
function FilterColumn_div_1_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "div", 2);
    ɵngcc0.ɵɵelementStart(2, "div", 3);
    ɵngcc0.ɵɵelementStart(3, "span", 4);
    ɵngcc0.ɵɵelementStart(4, "input", 5);
    ɵngcc0.ɵɵlistener("input", function FilterColumn_div_1_Template_input_input_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r2 = ɵngcc0.ɵɵnextContext(); return ctx_r2.filtrar($event); })("ngModelChange", function FilterColumn_div_1_Template_input_ngModelChange_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.filtro = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "label");
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵstyleMap(ɵngcc0.ɵɵpureFunction0(4, _c0));
    ɵngcc0.ɵɵproperty("ngModel", ctx_r0.filtro);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.header ? ctx_r0.header : "Filtro");
} }
const _c1 = function () { return { "width": "100%", "vertical-align": "top" }; };
const _c2 = function () { return { standalone: true }; };
function FilterColumn_div_2_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "div", 2);
    ɵngcc0.ɵɵelementStart(2, "div", 3);
    ɵngcc0.ɵɵelementStart(3, "p-multiSelect", 6);
    ɵngcc0.ɵɵlistener("onChange", function FilterColumn_div_2_Template_p_multiSelect_onChange_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.filtrar($event); })("ngModelChange", function FilterColumn_div_2_Template_p_multiSelect_ngModelChange_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.filtro = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵstyleMap(ɵngcc0.ɵɵpureFunction0(7, _c1));
    ɵngcc0.ɵɵproperty("options", ctx_r1.getCustomFilterOptions())("defaultLabel", ctx_r1.header ? ctx_r1.header : "\u00A0")("optionLabel", "label")("ngModelOptions", ɵngcc0.ɵɵpureFunction0(8, _c2))("ngModel", ctx_r1.filtro);
} }
export class FilterColumn {
    constructor() {
        this.listaOriginal = [];
        this.lista = [];
        this.labelDefaultImplementation = false;
        this.updateFiltro = false;
        this.customFilterOptions = {};
        this.template = 'filter_text';
        this.outputEvent = new EventEmitter();
        this.debouncer = new Subject();
        this.resultado = [];
        this.listaFields = [];
    }
    ngOnInit() {
        this.debouncer
            .pipe(debounceTime((this.tableType === 'memory') ? 300 : 1000))
            .subscribe((value) => this.outputEvent.emit(value));
        this.template = `filter_${this.filterType}`;
    }
    ngOnChanges(changes) {
        if (this.checkChanges(changes, 'listaOriginal')) {
            this.preencherFields();
        }
    }
    checkChanges(changes, property) {
        return changes[property] && changes[property].previousValue != changes[property].currentValue;
    }
    /**
     * Método para propagar o evento de filtragem
     * @param event filtro
     */
    filtrar(event) {
        this.debouncer.next(this.filtro);
    }
    /**
     * Preenche os itens que serão exibidos no multiselect, removendo duplicidades
     */
    preencherFields() {
        this.listaFields = [];
        this.listaOriginal.filter(pi => pi[this.field] !== null).forEach(row => {
            let item = { label: row[this.field], value: row[this.field] };
            if (!this.verificarSeExisteField(item)) {
                this.listaFields.push(item);
            }
        });
    }
    /**
     *
     * @param field Verifica duplicidade de fields nas opções de seleção
     */
    verificarSeExisteField(field) {
        return this.listaFields.some(item => {
            return item.value == field.value;
        });
    }
    /**
     * Caso o usuaŕio não forneça uma lista para o options, será criada uma lista com
     * os valores presentes na tabela
     */
    getCustomFilterOptions() {
        if (this.customFilterOptions.hasOwnProperty(this.field)) {
            return this.customFilterOptions[this.field];
        }
        return this.listaFields;
    }
}
FilterColumn.ɵfac = function FilterColumn_Factory(t) { return new (t || FilterColumn)(); };
FilterColumn.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FilterColumn, selectors: [["basis-filter-column"]], inputs: { listaOriginal: "listaOriginal", lista: "lista", labelDefaultImplementation: "labelDefaultImplementation", updateFiltro: "updateFiltro", customFilterOptions: "customFilterOptions", template: "template", field: "field", header: "header", labelDefaultName: "labelDefaultName", filterType: "filterType", tableType: "tableType" }, outputs: { outputEvent: "outputEvent" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 3, vars: 3, consts: [[3, "ngSwitch"], [4, "ngSwitchCase"], [1, "p-g", "form-group"], [1, "p-md-12"], [1, "p-float-label"], ["type", "text", "pInputText", "", 3, "ngModel", "input", "ngModelChange"], ["appendTo", "body", 3, "options", "defaultLabel", "optionLabel", "ngModelOptions", "ngModel", "onChange", "ngModelChange"]], template: function FilterColumn_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, FilterColumn_div_1_Template, 7, 5, "div", 1);
        ɵngcc0.ɵɵtemplate(2, FilterColumn_div_2_Template, 4, 9, "div", 1);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngSwitch", ctx.filterType);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", "text");
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngSwitchCase", "select");
    } }, directives: [ɵngcc1.NgSwitch, ɵngcc1.NgSwitchCase, ɵngcc2.DefaultValueAccessor, ɵngcc3.InputText, ɵngcc2.NgControlStatus, ɵngcc2.NgModel, ɵngcc4.MultiSelect], encapsulation: 2 });
FilterColumn.ctorParameters = () => [];
FilterColumn.propDecorators = {
    listaOriginal: [{ type: Input }],
    lista: [{ type: Input }],
    field: [{ type: Input }],
    header: [{ type: Input }],
    labelDefaultImplementation: [{ type: Input }],
    labelDefaultName: [{ type: Input }],
    updateFiltro: [{ type: Input }],
    filterType: [{ type: Input }],
    tableType: [{ type: Input }],
    customFilterOptions: [{ type: Input }],
    template: [{ type: Input }],
    outputEvent: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FilterColumn, [{
        type: Component,
        args: [{
                selector: 'basis-filter-column',
                template: "<div [ngSwitch]=\"filterType\" >\n    <div *ngSwitchCase=\"'text'\">\n        <div class=\"p-g form-group\">\n            <div class=\"p-md-12\">\n                <span class=\"p-float-label\">\n                    <input type=\"text\" pInputText (input)=\"filtrar($event)\" [(ngModel)]=\"filtro\" [style]=\"{width: '100%'}\">\n                    <label>{{ (header) ? header : 'Filtro' }}</label>\n                </span>\n            </div>\n        </div>\n    </div>\n    <div *ngSwitchCase=\"'select'\">\n        <div class=\"p-g form-group\">\n            <div class=\"p-md-12\">\n                <p-multiSelect\n                    [options]=\"getCustomFilterOptions()\"\n                    [defaultLabel]=\"(header)? header: '&nbsp;'\"\n                    [optionLabel]=\"'label'\"\n                    appendTo=\"body\"\n                    [ngModelOptions]=\"{standalone: true}\"\n                    (onChange)=\"filtrar($event)\"\n                    [(ngModel)]=\"filtro\"\n                    [style]=\"{'width':'100%', 'vertical-align':'top'}\">\n                </p-multiSelect>\n            </div>\n        </div>\n    </div>\n</div>\n"
            }]
    }], function () { return []; }, { listaOriginal: [{
            type: Input
        }], lista: [{
            type: Input
        }], labelDefaultImplementation: [{
            type: Input
        }], updateFiltro: [{
            type: Input
        }], customFilterOptions: [{
            type: Input
        }], template: [{
            type: Input
        }], outputEvent: [{
            type: Output
        }], field: [{
            type: Input
        }], header: [{
            type: Input
        }], labelDefaultName: [{
            type: Input
        }], filterType: [{
            type: Input
        }], tableType: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWNvbHVtbi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3ByaW1lbmctY29tcG9uZW50cy9zcmMvbGliL2RhdGF0YWJsZS9maWx0ZXItY29sdW1uL2ZpbHRlci1jb2x1bW4uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQW1DLE1BQU0sZUFBZSxDQUFDO0FBQ3hHLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNOUMsTUFBTSxPQUFPLFlBQVk7QUFBRyxJQWtDeEI7QUFBZ0IsUUFoQ1Asa0JBQWEsR0FBVSxFQUFFLENBQUM7QUFDdkMsUUFDYSxVQUFLLEdBQVUsRUFBRSxDQUFDO0FBQy9CLFFBS2EsK0JBQTBCLEdBQVksS0FBSyxDQUFDO0FBQ3pELFFBR2EsaUJBQVksR0FBWSxLQUFLLENBQUM7QUFDM0MsUUFLYSx3QkFBbUIsR0FBVyxFQUFFLENBQUM7QUFDOUMsUUFDYSxhQUFRLEdBQUcsYUFBYSxDQUFDO0FBQ3RDLFFBQ2MsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0FBQy9DLFFBQ1ksY0FBUyxHQUFpQixJQUFJLE9BQU8sRUFBTyxDQUFDO0FBQ3pELFFBR0ksY0FBUyxHQUFVLEVBQUUsQ0FBQztBQUMxQixRQUNZLGdCQUFXLEdBQVUsRUFBRSxDQUFDO0FBQ3BDLElBQ29CLENBQUM7QUFDckIsSUFDSSxRQUFRO0FBQ1osUUFBUSxJQUFJLENBQUMsU0FBUztBQUN0QixhQUFhLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFFBQVEsQ0FBQyxDQUFBLENB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LEtBQUs7QUFBSywrQkFFVixLQUFLO0FBQUssMkJBRVYsS0FBSztBQUFLLHlCQUVWLEtBQUs7QUFBSyx3QkFFVixLQUFLO0FBQUssa0NBRVYsS0FBSztBQUFLLHVCQUVWLEtBQUs7QUFBSywwQkFFVixNQUFNO0FBQUk7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYmFzaXMtZmlsdGVyLWNvbHVtbicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZpbHRlci1jb2x1bW4uY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEZpbHRlckNvbHVtbiBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0IHtcblxuICAgIEBJbnB1dCgpIGxpc3RhT3JpZ2luYWw6IGFueVtdID0gW107XG5cbiAgICBASW5wdXQoKSBsaXN0YTogYW55W10gPSBbXTtcblxuICAgIEBJbnB1dCgpIGZpZWxkOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKSBoZWFkZXI6IHN0cmluZztcblxuICAgIEBJbnB1dCgpIGxhYmVsRGVmYXVsdEltcGxlbWVudGF0aW9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKSBsYWJlbERlZmF1bHROYW1lOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKSB1cGRhdGVGaWx0cm86IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIEBJbnB1dCgpIGZpbHRlclR5cGU6IHN0cmluZztcblxuICAgIEBJbnB1dCgpIHRhYmxlVHlwZTogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgY3VzdG9tRmlsdGVyT3B0aW9uczogT2JqZWN0ID0ge307XG5cbiAgICBASW5wdXQoKSB0ZW1wbGF0ZSA9ICdmaWx0ZXJfdGV4dCc7XG5cbiAgICBAT3V0cHV0KCkgb3V0cHV0RXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBwcml2YXRlIGRlYm91bmNlcjogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3Q8YW55PigpO1xuXG4gICAgZmlsdHJvOiBhbnk7XG5cbiAgICByZXN1bHRhZG86IGFueVtdID0gW107XG5cbiAgICBwcml2YXRlIGxpc3RhRmllbGRzOiBhbnlbXSA9IFtdO1xuXG4gICAgY29uc3RydWN0b3IoKSB7IH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmRlYm91bmNlclxuICAgICAgICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKCh0aGlzLnRhYmxlVHlwZSA9PT0gJ21lbW9yeScpPyAzMDAgOiAxMDAwKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHZhbHVlKSA9PiB0aGlzLm91dHB1dEV2ZW50LmVtaXQodmFsdWUpKTtcblxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gYGZpbHRlcl8ke3RoaXMuZmlsdGVyVHlwZX1gO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBTaW1wbGVDaGFuZ2UgfSkge1xuICAgICAgICBpZiAodGhpcy5jaGVja0NoYW5nZXMoY2hhbmdlcywgJ2xpc3RhT3JpZ2luYWwnKSkge1xuICAgICAgICAgICAgdGhpcy5wcmVlbmNoZXJGaWVsZHMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNoZWNrQ2hhbmdlcyhjaGFuZ2VzOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogU2ltcGxlQ2hhbmdlIH0sIHByb3BlcnR5KSB7XG4gICAgICAgIHJldHVybiBjaGFuZ2VzW3Byb3BlcnR5XSAmJiBjaGFuZ2VzW3Byb3BlcnR5XS5wcmV2aW91c1ZhbHVlICE9IGNoYW5nZXNbcHJvcGVydHldLmN1cnJlbnRWYWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNw6l0b2RvIHBhcmEgcHJvcGFnYXIgbyBldmVudG8gZGUgZmlsdHJhZ2VtXG4gICAgICogQHBhcmFtIGV2ZW50IGZpbHRyb1xuICAgICAqL1xuICAgIGZpbHRyYXIoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5kZWJvdW5jZXIubmV4dCh0aGlzLmZpbHRybyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlZW5jaGUgb3MgaXRlbnMgcXVlIHNlcsOjbyBleGliaWRvcyBubyBtdWx0aXNlbGVjdCwgcmVtb3ZlbmRvIGR1cGxpY2lkYWRlc1xuICAgICAqL1xuICAgIHByZWVuY2hlckZpZWxkcygpIHtcbiAgICAgICAgdGhpcy5saXN0YUZpZWxkcyA9IFtdO1xuICAgICAgICB0aGlzLmxpc3RhT3JpZ2luYWwuZmlsdGVyKHBpID0+IHBpW3RoaXMuZmllbGRdICE9PSBudWxsKS5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9IHtsYWJlbDogcm93W3RoaXMuZmllbGRdLCB2YWx1ZTogcm93W3RoaXMuZmllbGRdfTtcbiAgICAgICAgICAgIGlmICghdGhpcy52ZXJpZmljYXJTZUV4aXN0ZUZpZWxkKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5saXN0YUZpZWxkcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWVsZCBWZXJpZmljYSBkdXBsaWNpZGFkZSBkZSBmaWVsZHMgbmFzIG9ww6fDtWVzIGRlIHNlbGXDp8Ojb1xuICAgICAqL1xuICAgIHZlcmlmaWNhclNlRXhpc3RlRmllbGQoZmllbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGFGaWVsZHMuc29tZShpdGVtID0+IHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtLnZhbHVlID09IGZpZWxkLnZhbHVlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYXNvIG8gdXN1YcWVaW8gbsOjbyBmb3JuZcOnYSB1bWEgbGlzdGEgcGFyYSBvIG9wdGlvbnMsIHNlcsOhIGNyaWFkYSB1bWEgbGlzdGEgY29tXG4gICAgICogb3MgdmFsb3JlcyBwcmVzZW50ZXMgbmEgdGFiZWxhXG4gICAgICovXG4gICAgZ2V0Q3VzdG9tRmlsdGVyT3B0aW9ucygpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tRmlsdGVyT3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSh0aGlzLmZpZWxkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRmlsdGVyT3B0aW9uc1t0aGlzLmZpZWxkXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RhRmllbGRzO1xuICAgIH1cblxufVxuIl19