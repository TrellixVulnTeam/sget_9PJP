/**
 * Class ServerDataProvider
 * @class
 */
export class ServerDataProvider {
    /**
     * constructor method
     * @constructor
     * @param {DatatableService} datatableService
     * @param {DatatableComponent} component
     */
    constructor(datatableService, component) {
        this.datatableService = datatableService;
        this.component = component;
        this.component.pDatatableComponent.onLazyLoad.subscribe((event) => this.onLazyLoad(event));
        this.component.pDatatableComponent.lazy = true;
    }
    /**
     * onLazyLoad method
     * @param {LazyLoadEvent} onLazyLoad
     * @returns void
     */
    onLazyLoad(event) {
        this.currentLazyLoadEvent = event;
        this.load();
    }
    /**
     * load method
     * @param {any} query
     * @returns void
     */
    load(query) {
        query = this.retrieveAndSaveQuery(query);
        this.component.startedLoading.emit();
        this.datatableService.search(this.currentLazyLoadEvent, this.component.url, this.component.pDatatableComponent.rows, this.component.orderInSort, query)
            .toPromise()
            .then((response) => {
            this.treatLoadResponse(response);
            this.component.finishedLoading.emit();
        }, (error) => {
            this.component.finishedLoading.emit(error);
        });
    }
    /**
     * treatLoadResponse method
     * @param {any} response
     * @return void
     */
    treatLoadResponse(response) {
        const data = response.body;
        if (this.component.paginationParameters) {
            this.treatLoadResponseWithPaginationParameters(data);
        }
        else {
            this.treatLoadResponseWithoutPaginationParameters(response, data);
        }
    }
    /**
     * treatLoadResponseWithPaginationParameters method
     * @param {any} data
     * @returns void
     */
    treatLoadResponseWithPaginationParameters(data) {
        let contentIndex = this.component.paginationParameters.contentIndex;
        let totalIndex = this.component.paginationParameters.totalElementsIndex;
        this.component.value = (data[contentIndex]) ? data[contentIndex] : data;
        this.component.pDatatableComponent.totalRecords = (data[totalIndex]) ? data[totalIndex] : this.component.value.length;
    }
    /**
     * treatLoadResponseWithoutPaginationParameters method
     * @param {any} response
     * @param {any} data
     * @returns void
     */
    treatLoadResponseWithoutPaginationParameters(response, data) {
        if (response.headers.has('x-total-count')) {
            this.component.pDatatableComponent.totalRecords = parseInt(response.headers.get('x-total-count'), 10);
            this.component.value = data;
        }
        else {
            this.component.pDatatableComponent.totalRecords = data.totalElements;
            this.component.value = data.content;
        }
    }
    /**
     * retrieveAndSaveQuery method
     * @param {any} query
     * @returns any
     */
    retrieveAndSaveQuery(query) {
        const oldQuery = this._query;
        const currentQuery = this.doRetrieveAndSaveQuery(query);
        this.resetToFirstPageIfQueryChanged(oldQuery, currentQuery);
        return currentQuery;
    }
    /**
     * doRetrieveAndSaveQuery method
     * @param {any} query
     * @returns any
     */
    doRetrieveAndSaveQuery(query) {
        if ('object' === typeof query && query.value) {
            this._query = query.value;
        }
        else if (query) {
            this._query = query;
        }
        return this._query;
    }
    /**
     * resetToFirstPageIfQueryChanged method
     * @param {any} oldQuery
     * @param {any} currentQuery
     * @returns void
     */
    resetToFirstPageIfQueryChanged(oldQuery, currentQuery) {
        if (oldQuery !== currentQuery) {
            this.currentLazyLoadEvent.first = 0;
            this.component.pDatatableComponent.first = 0;
        }
    }
    /**
     * reset method
     * @returns void
     */
    reset() {
        this._query = undefined;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLWRhdGFwcm92aWRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3ByaW1lbmctY29tcG9uZW50cy9zcmMvbGliL2RhdGF0YWJsZS9zZXJ2ZXItZGF0YXByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBOzs7R0FHRztBQUNILE1BQU0sT0FBTyxrQkFBa0I7SUFjM0I7Ozs7O09BS0c7SUFDSCxZQUFvQixnQkFBa0MsRUFBVSxTQUE2QjtRQUF6RSxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBb0I7UUFDekYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBb0IsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzFHLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUNuRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFVBQVUsQ0FBQyxLQUFvQjtRQUMzQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsS0FBSyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILElBQUksQ0FBQyxLQUFXO1FBQ1osS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUN4QixJQUFJLENBQUMsb0JBQW9CLEVBQ3pCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUNsQixJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFDdkMsSUFB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SUFBSSxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztTQUN2QjtRQUNELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSyw4QkFBOEIsQ0FBQyxRQUFRLEVBQUUsWUFBWTtRQUN6RCxJQUFJLFFBQVEsS0FBSyxZQUFZLEVBQUU7WUFDM0IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1NBQ2hEO0lBQ0wsQ0FBQztJQUNEOzs7T0FHRztJQUNILEtBQUs7UUFDRCxJQUFJLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztJQUM1QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMYXp5TG9hZEV2ZW50IH0gZnJvbSAncHJpbWVuZy9hcGknO1xuaW1wb3J0IHsgRGF0YXRhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi9kYXRhdGFibGUuY29tcG9uZW50JztcbmltcG9ydCB7IERhdGF0YWJsZVNlcnZpY2UgfSBmcm9tICcuL2RhdGF0YWJsZS5zZXJ2aWNlJztcbmltcG9ydCB7IERhdGFQcm92aWRlciB9IGZyb20gJy4vZGF0YXByb3ZpZGVyJztcblxuLyoqXG4gKiBDbGFzcyBTZXJ2ZXJEYXRhUHJvdmlkZXJcbiAqIEBjbGFzc1xuICovXG5leHBvcnQgY2xhc3MgU2VydmVyRGF0YVByb3ZpZGVyIGltcGxlbWVudHMgRGF0YVByb3ZpZGVyIHtcblxuICAgIC8qKlxuICAgICAqIGN1cnJlbnRMYXp5TG9hZEV2ZW50IHByb3BlcnR5XG4gICAgICogQHR5cGUge0xhenlMb2FkRXZlbnR9XG4gICAgICovXG4gICAgY3VycmVudExhenlMb2FkRXZlbnQ6IExhenlMb2FkRXZlbnQ7XG5cbiAgICAvKipcbiAgICAgKiBfcXVlcnkgcHJvcGVydHlcbiAgICAgKiBAdHlwZSB7YW55fVxuICAgICAqL1xuICAgIHByaXZhdGUgX3F1ZXJ5OiBhbnk7XG5cbiAgICAvKipcbiAgICAgKiBjb25zdHJ1Y3RvciBtZXRob2RcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge0RhdGF0YWJsZVNlcnZpY2V9IGRhdGF0YWJsZVNlcnZpY2VcbiAgICAgKiBAcGFyYW0ge0RhdGF0YWJsZUNvbXBvbmVudH0gY29tcG9uZW50XG4gICAgICovXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkYXRhdGFibGVTZXJ2aWNlOiBEYXRhdGFibGVTZXJ2aWNlLCBwcml2YXRlIGNvbXBvbmVudDogRGF0YXRhYmxlQ29tcG9uZW50KSB7XG4gICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQub25MYXp5TG9hZC5zdWJzY3JpYmUoKGV2ZW50OiBMYXp5TG9hZEV2ZW50KSA9PiB0aGlzLm9uTGF6eUxvYWQoZXZlbnQpKTtcbiAgICAgICAgdGhpcy5jb21wb25lbnQucERhdGF0YWJsZUNvbXBvbmVudC5sYXp5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBvbkxhenlMb2FkIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7TGF6eUxvYWRFdmVudH0gb25MYXp5TG9hZFxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBvbkxhenlMb2FkKGV2ZW50OiBMYXp5TG9hZEV2ZW50KSB7XG4gICAgICAgIHRoaXMuY3VycmVudExhenlMb2FkRXZlbnQgPSBldmVudDtcbiAgICAgICAgdGhpcy5sb2FkKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogbG9hZCBtZXRob2RcbiAgICAgKiBAcGFyYW0ge2FueX0gcXVlcnlcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgbG9hZChxdWVyeT86IGFueSk6IHZvaWQge1xuICAgICAgICBxdWVyeSA9IHRoaXMucmV0cmlldmVBbmRTYXZlUXVlcnkocXVlcnkpO1xuICAgICAgICB0aGlzLmNvbXBvbmVudC5zdGFydGVkTG9hZGluZy5lbWl0KCk7XG4gICAgICAgIHRoaXMuZGF0YXRhYmxlU2VydmljZS5zZWFyY2goXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMYXp5TG9hZEV2ZW50LFxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQudXJsLFxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQucERhdGF0YWJsZUNvbXBvbmVudC5yb3dzLFxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQub3JkZXJJblNvcnQsXG4gICAgICAgICAgICBxdWVyeSlcbiAgICAgICAgICAgIC50b1Byb21pc2UoKVxuICAgICAgICAgICAgLnRoZW4oXG4gICAgICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWF0TG9hZFJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5maW5pc2hlZExvYWRpbmcuZW1pdCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LmZpbmlzaGVkTG9hZGluZy5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB0cmVhdExvYWRSZXNwb25zZSBtZXRob2RcbiAgICAgKiBAcGFyYW0ge2FueX0gcmVzcG9uc2VcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBwcml2YXRlIHRyZWF0TG9hZFJlc3BvbnNlKHJlc3BvbnNlOiBhbnkpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmJvZHk7XG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudC5wYWdpbmF0aW9uUGFyYW1ldGVycykge1xuICAgICAgICAgICAgdGhpcy50cmVhdExvYWRSZXNwb25zZVdpdGhQYWdpbmF0aW9uUGFyYW1ldGVycyhkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudHJlYXRMb2FkUmVzcG9uc2VXaXRob3V0UGFnaW5hdGlvblBhcmFtZXRlcnMocmVzcG9uc2UsIGRhdGEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdHJlYXRMb2FkUmVzcG9uc2VXaXRoUGFnaW5hdGlvblBhcmFtZXRlcnMgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IGRhdGFcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgcHJpdmF0ZSB0cmVhdExvYWRSZXNwb25zZVdpdGhQYWdpbmF0aW9uUGFyYW1ldGVycyhkYXRhKSB7XG4gICAgICAgIGxldCBjb250ZW50SW5kZXggPSB0aGlzLmNvbXBvbmVudC5wYWdpbmF0aW9uUGFyYW1ldGVycy5jb250ZW50SW5kZXg7XG4gICAgICAgIGxldCB0b3RhbEluZGV4ID0gdGhpcy5jb21wb25lbnQucGFnaW5hdGlvblBhcmFtZXRlcnMudG90YWxFbGVtZW50c0luZGV4O1xuICAgICAgICB0aGlzLmNvbXBvbmVudC52YWx1ZSA9IChkYXRhW2NvbnRlbnRJbmRleF0pPyBkYXRhW2NvbnRlbnRJbmRleF06IGRhdGE7XG4gICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQudG90YWxSZWNvcmRzID0gKGRhdGFbdG90YWxJbmRleF0pPyBkYXRhW3RvdGFsSW5kZXhdOiB0aGlzLmNvbXBvbmVudC52YWx1ZS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdHJlYXRMb2FkUmVzcG9uc2VXaXRob3V0UGFnaW5hdGlvblBhcmFtZXRlcnMgbWV0aG9kXG4gICAgICogQHBhcmFtIHthbnl9IHJlc3BvbnNlXG4gICAgICogQHBhcmFtIHthbnl9IGRhdGFcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgcHJpdmF0ZSB0cmVhdExvYWRSZXNwb25zZVdpdGhvdXRQYWdpbmF0aW9uUGFyYW1ldGVycyhyZXNwb25zZTogYW55LCBkYXRhKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5oZWFkZXJzLmhhcygneC10b3RhbC1jb3VudCcpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudC5wRGF0YXRhYmxlQ29tcG9uZW50LnRvdGFsUmVjb3JkcyA9IHBhcnNlSW50KHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCd4LXRvdGFsLWNvdW50JyksIDEwKTtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnZhbHVlID0gZGF0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50LnBEYXRhdGFibGVDb21wb25lbnQudG90YWxSZWNvcmRzID0gZGF0YS50b3RhbEVsZW1lbnRzO1xuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQudmFsdWUgPSBkYXRhLmNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiByZXRyaWV2ZUFuZFNhdmVRdWVyeSBtZXRob2RcbiAgICAgKiBAcGFyYW0ge2FueX0gcXVlcnlcbiAgICAgKiBAcmV0dXJucyBhbnlcbiAgICAgKi9cbiAgICBwcml2YXRlIHJldHJpZXZlQW5kU2F2ZVF1ZXJ5KHF1ZXJ5OiBhbnkpOiBhbnkge1xuICAgICAgICBjb25zdCBvbGRRdWVyeSA9IHRoaXMuX3F1ZXJ5O1xuICAgICAgICBjb25zdCBjdXJyZW50UXVlcnkgPSB0aGlzLmRvUmV0cmlldmVBbmRTYXZlUXVlcnkocXVlcnkpO1xuICAgICAgICB0aGlzLnJlc2V0VG9GaXJzdFBhZ2VJZlF1ZXJ5Q2hhbmdlZChvbGRRdWVyeSwgY3VycmVudFF1ZXJ5KTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVyeTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBkb1JldHJpZXZlQW5kU2F2ZVF1ZXJ5IG1ldGhvZFxuICAgICAqIEBwYXJhbSB7YW55fSBxdWVyeVxuICAgICAqIEByZXR1cm5zIGFueVxuICAgICAqL1xuICAgIHByaXZhdGUgZG9SZXRyaWV2ZUFuZFNhdmVRdWVyeShxdWVyeTogYW55KTogYW55IHtcbiAgICAgICAgaWYgKCdvYmplY3QnID09PSB0eXBlb2YgcXVlcnkgJiYgcXVlcnkudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuX3F1ZXJ5ID0gcXVlcnkudmFsdWU7XG4gICAgICAgIH0gZWxzZSBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIHRoaXMuX3F1ZXJ5ID0gcXVlcnk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHJlc2V0VG9GaXJzdFBhZ2VJZlF1ZXJ5Q2hhbmdlZCBtZXRob2RcbiAgICAgKiBAcGFyYW0ge2FueX0gb2xkUXVlcnlcbiAgICAgKiBAcGFyYW0ge2FueX0gY3VycmVudFF1ZXJ5XG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHByaXZhdGUgcmVzZXRUb0ZpcnN0UGFnZUlmUXVlcnlDaGFuZ2VkKG9sZFF1ZXJ5LCBjdXJyZW50UXVlcnkpIHtcbiAgICAgICAgaWYgKG9sZFF1ZXJ5ICE9PSBjdXJyZW50UXVlcnkpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudExhenlMb2FkRXZlbnQuZmlyc3QgPSAwO1xuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQucERhdGF0YWJsZUNvbXBvbmVudC5maXJzdCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogcmVzZXQgbWV0aG9kXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLl9xdWVyeSA9IHVuZGVmaW5lZDtcbiAgICB9XG59XG4iXX0=