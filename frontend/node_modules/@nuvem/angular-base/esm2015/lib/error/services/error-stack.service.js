import { Injectable } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { HttpGenericErrorService } from '../services/http-generic-error.service';
import * as i0 from "@angular/core";
import * as i1 from "./http-generic-error.service";
/**
 * Serviço de erros ErrorStackService
 * @class
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../services/http-generic-error.service';
export class ErrorStackService {
    /**
     * metodo construtor injeta serviço generico de erros
     * @param {HttpGenericErrorService} genericErrorService
     * @constructor
     */
    constructor(genericErrorService) {
        this.genericErrorService = genericErrorService;
        /**
         * Propriedade errors
         * @type {ReplaySubject<NamedErrorType>}
         */
        this.errors = new ReplaySubject();
        if (null === localStorage.getItem('errorStack')) {
            localStorage.setItem('errorStack', JSON.stringify([]));
        }
        this.getErrorsSubjects().forEach((error) => {
            this.errors.next(error);
        });
    }
    /**
     * Metodo responsável por criar erro do tipo HttpResponse
     * @param {HttpErrorResponse} error
     * @returns void
     */
    create(error) {
        const namedError = this.createNamedError(error);
        const persistedErrors = this.getErrorsSubjects();
        if (persistedErrors.length >= 15) {
            persistedErrors.shift();
        }
        persistedErrors.push(namedError);
        localStorage.setItem('errorStack', JSON.stringify(persistedErrors));
        this.errors.next(namedError);
    }
    /**
     * Metodo responsável por obter o conteúdo dos erros emitidos
     * @private
     * @returns NamedErrorType[]
     */
    getErrorsSubjects() {
        return JSON.parse(localStorage.getItem('errorStack'));
    }
    /**
     * Metodo responsável por itentifica o tipo de erro lançado
     * @private
     * @param {HttpErrorResponse} error
     * @returns NamedErrorType
     */
    createNamedError(error) {
        let fullMessage;
        let namedError;
        let createdAt = new Date();
        let errorId = this.getErrorId(error);
        let title;
        if (error.headers.get('Content-Type') === 'application/problem+json') {
            fullMessage = `X-Correlation-ID: ${errorId}
                           createdAt: ${createdAt}
                           status: ${error.status}
                           url: ${error.url}
                           body: ${error.error.detail}
                           stacktrace: ${error.error.stacktrace}
                           cause: ${error.error.cause}`;
            title = error.error.title;
        }
        else {
            const genericError = this.genericErrorService.getErrorByCode(error);
            fullMessage = `X-Correlation-ID: ${errorId}
                           createdAt: ${createdAt}
                           status: ${error.status}
                           url: ${error.url}
                           body: ${genericError.detail}`;
            title = genericError.title;
        }
        namedError = {
            message: title,
            createdAt: createdAt,
            correlationId: errorId,
            fullMessage: fullMessage
        };
        return namedError;
    }
    /**
     * Metodo responsável por obter o identificador do erro
     * @private
     * @param {HttpErrorResponse} error
     * @returns string
     */
    getErrorId(error) {
        let errorKey;
        error.headers.keys().every(key => {
            if (key.toUpperCase() === 'X-CORRELATION-ID') {
                errorKey = key;
                return false;
            }
            return true;
        });
        return errorKey ? error.headers.get(errorKey) : null;
    }
}
ErrorStackService.ɵfac = function ErrorStackService_Factory(t) { return new (t || ErrorStackService)(ɵngcc0.ɵɵinject(ɵngcc1.HttpGenericErrorService)); };
ErrorStackService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ErrorStackService_Factory() { return new ErrorStackService(i0.ɵɵinject(i1.HttpGenericErrorService)); }, token: ErrorStackService, providedIn: "root" });
ErrorStackService.ctorParameters = () => [
    { type: HttpGenericErrorService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ErrorStackService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.HttpGenericErrorService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3Itc3RhY2suc2VydmljZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYW5ndWxhci1iYXNlL3NyYy9saWIvZXJyb3Ivc2VydmljZXMvZXJyb3Itc3RhY2suc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHckMsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDakY7QUFFZ0M7QUFEaEM7QUFDQTtBQUNBO0FBQVUsR0FDUDs7O0FBSUgsTUFBTSxPQUFPLGlCQUFpQjtBQUM5QixJQU9JO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLElBQUksWUFBb0IsbUJBQTRDO0FBQ3BFLFFBRHdCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBeUI7QUFBQyxRQVhqRTtBQUNKO0FBQ0k7QUFFSixXQURPO0FBQ1AsUUFBSSxXQUFNLEdBQWtDLElBQUksYUFBYSxFQUFrQixDQUFDO0FBQ2hGLFFBT1EsSUFBSSxJQUFJLEtBQUssWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBRTtBQUN6RCxZQUFZLFlBQVksQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNuRSxTQUFTO0FBQ1QsUUFDUSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFxQixFQUFFLEVBQUU7QUFDbkUsWUFBWSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQ1gsSUFBSSxDQUFDO0FBQ0wsSUFDSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxJQUFJLE1BQU0sQ0FBQyxL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LEVBQUU7QUFDekMsWUFBWSxJQUFJLEdBQUcsQ0FBQyxXQUFXLEVBQUUsS0FBSyxrQkFBa0IsRUFBRTtBQUMxRCxnQkFBZ0IsUUFBUSxHQUFHLEdBQUcsQ0FBQztBQUMvQixnQkFBZ0IsT0FBTyxLQUFLLENBQUM7QUFDN0IsYUFBYTtBQUNiLFlBQVksT0FBTyxJQUFJLENBQUM7QUFDeEIsUUFBUSxDQUFDLENBQUMsQ0FBQztBQUNYLFFBQ1EsT0FBTyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDN0QsSUFBSSxDQUFDO0FBQ0w7eUpBQ0E7QUFBQyw0TkF2SEk7QUFBQztFQUhMLFVBQVUsU0FBQyxyQkFNTCxZQVpFLHVCQUF1QjtDQU81QixEQVArQjtRQU9yQixFQUFFLE1BQU0sZUFDckI7Ozs7O3dGQVJvQztBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTmFtZWRFcnJvclR5cGUgfSBmcm9tICcuLi90eXBlcy9uYW1lZC1lcnJvci50eXBlJztcbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSHR0cEdlbmVyaWNFcnJvclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9odHRwLWdlbmVyaWMtZXJyb3Iuc2VydmljZSc7XG5cbi8qKlxuICogU2VydmnDp28gZGUgZXJyb3MgRXJyb3JTdGFja1NlcnZpY2VcbiAqIEBjbGFzcyBcbiAqL1xuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgRXJyb3JTdGFja1NlcnZpY2Uge1xuXG4gICAgLyoqXG4gICAgICogUHJvcHJpZWRhZGUgZXJyb3JzXG4gICAgICogQHR5cGUge1JlcGxheVN1YmplY3Q8TmFtZWRFcnJvclR5cGU+fVxuICAgICAqL1xuICAgIGVycm9yczogUmVwbGF5U3ViamVjdDxOYW1lZEVycm9yVHlwZT4gPSBuZXcgUmVwbGF5U3ViamVjdDxOYW1lZEVycm9yVHlwZT4oKTtcblxuICAgIC8qKlxuICAgICAqIG1ldG9kbyBjb25zdHJ1dG9yIGluamV0YSBzZXJ2acOnbyBnZW5lcmljbyBkZSBlcnJvc1xuICAgICAqIEBwYXJhbSB7SHR0cEdlbmVyaWNFcnJvclNlcnZpY2V9IGdlbmVyaWNFcnJvclNlcnZpY2VcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGdlbmVyaWNFcnJvclNlcnZpY2U6IEh0dHBHZW5lcmljRXJyb3JTZXJ2aWNlKSB7XG4gICAgICAgIGlmIChudWxsID09PSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZXJyb3JTdGFjaycpKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZXJyb3JTdGFjaycsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmdldEVycm9yc1N1YmplY3RzKCkuZm9yRWFjaCgoZXJyb3I6IE5hbWVkRXJyb3JUeXBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVycm9ycy5uZXh0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0b2RvIHJlc3BvbnPDoXZlbCBwb3IgY3JpYXIgZXJybyBkbyB0aXBvIEh0dHBSZXNwb25zZVxuICAgICAqIEBwYXJhbSB7SHR0cEVycm9yUmVzcG9uc2V9IGVycm9yXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIGNyZWF0ZShlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpIHtcbiAgICAgICAgY29uc3QgbmFtZWRFcnJvciA9IHRoaXMuY3JlYXRlTmFtZWRFcnJvcihlcnJvcik7XG5cbiAgICAgICAgY29uc3QgcGVyc2lzdGVkRXJyb3JzOiBOYW1lZEVycm9yVHlwZVtdID0gdGhpcy5nZXRFcnJvcnNTdWJqZWN0cygpO1xuXG4gICAgICAgIGlmIChwZXJzaXN0ZWRFcnJvcnMubGVuZ3RoID49IDE1KSB7XG4gICAgICAgICAgICBwZXJzaXN0ZWRFcnJvcnMuc2hpZnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBlcnNpc3RlZEVycm9ycy5wdXNoKG5hbWVkRXJyb3IpO1xuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdlcnJvclN0YWNrJywgSlNPTi5zdHJpbmdpZnkocGVyc2lzdGVkRXJyb3JzKSk7XG5cbiAgICAgICAgdGhpcy5lcnJvcnMubmV4dChuYW1lZEVycm9yKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRvZG8gcmVzcG9uc8OhdmVsIHBvciBvYnRlciBvIGNvbnRlw7pkbyBkb3MgZXJyb3MgZW1pdGlkb3NcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm5zIE5hbWVkRXJyb3JUeXBlW11cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldEVycm9yc1N1YmplY3RzKCk6IE5hbWVkRXJyb3JUeXBlW10ge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZXJyb3JTdGFjaycpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRvZG8gcmVzcG9uc8OhdmVsIHBvciBpdGVudGlmaWNhIG8gdGlwbyBkZSBlcnJvIGxhbsOnYWRvXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0h0dHBFcnJvclJlc3BvbnNlfSBlcnJvclxuICAgICAqIEByZXR1cm5zIE5hbWVkRXJyb3JUeXBlXG4gICAgICovXG4gICAgcHJpdmF0ZSBjcmVhdGVOYW1lZEVycm9yKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSk6IE5hbWVkRXJyb3JUeXBlIHtcbiAgICAgICAgbGV0IGZ1bGxNZXNzYWdlOiBzdHJpbmc7XG4gICAgICAgIGxldCBuYW1lZEVycm9yOiBOYW1lZEVycm9yVHlwZTtcbiAgICAgICAgbGV0IGNyZWF0ZWRBdDogRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGxldCBlcnJvcklkID0gdGhpcy5nZXRFcnJvcklkKGVycm9yKTtcbiAgICAgICAgbGV0IHRpdGxlOiBzdHJpbmcgfCBudWxsO1xuXG4gICAgICAgIGlmIChlcnJvci5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgPT09ICdhcHBsaWNhdGlvbi9wcm9ibGVtK2pzb24nKSB7XG4gICAgICAgICAgICBmdWxsTWVzc2FnZSA9IGBYLUNvcnJlbGF0aW9uLUlEOiAke2Vycm9ySWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6ICR7Y3JlYXRlZEF0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAke2Vycm9yLnN0YXR1c31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJHtlcnJvci51cmx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiAke2Vycm9yLmVycm9yLmRldGFpbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrdHJhY2U6ICR7ZXJyb3IuZXJyb3Iuc3RhY2t0cmFjZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlOiAke2Vycm9yLmVycm9yLmNhdXNlfWA7XG5cbiAgICAgICAgICAgIHRpdGxlID0gZXJyb3IuZXJyb3IudGl0bGU7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyaWNFcnJvciA9IHRoaXMuZ2VuZXJpY0Vycm9yU2VydmljZS5nZXRFcnJvckJ5Q29kZShlcnJvcik7XG5cbiAgICAgICAgICAgIGZ1bGxNZXNzYWdlID0gYFgtQ29ycmVsYXRpb24tSUQ6ICR7ZXJyb3JJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogJHtjcmVhdGVkQXR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICR7ZXJyb3Iuc3RhdHVzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAke2Vycm9yLnVybH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6ICR7Z2VuZXJpY0Vycm9yLmRldGFpbH1gO1xuXG4gICAgICAgICAgICB0aXRsZSA9IGdlbmVyaWNFcnJvci50aXRsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5hbWVkRXJyb3IgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiB0aXRsZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogY3JlYXRlZEF0LFxuICAgICAgICAgICAgY29ycmVsYXRpb25JZDogZXJyb3JJZCxcbiAgICAgICAgICAgIGZ1bGxNZXNzYWdlOiBmdWxsTWVzc2FnZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBuYW1lZEVycm9yO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ldG9kbyByZXNwb25zw6F2ZWwgcG9yIG9idGVyIG8gaWRlbnRpZmljYWRvciBkbyBlcnJvXG4gICAgICogQHByaXZhdGUgXG4gICAgICogQHBhcmFtIHtIdHRwRXJyb3JSZXNwb25zZX0gZXJyb3JcbiAgICAgKiBAcmV0dXJucyBzdHJpbmdcbiAgICAgKi9cbiAgICBwcml2YXRlIGdldEVycm9ySWQoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGVycm9yS2V5OiBzdHJpbmcgfCBudWxsO1xuXG4gICAgICAgIGVycm9yLmhlYWRlcnMua2V5cygpLmV2ZXJ5KGtleSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5LnRvVXBwZXJDYXNlKCkgPT09ICdYLUNPUlJFTEFUSU9OLUlEJykge1xuICAgICAgICAgICAgICAgIGVycm9yS2V5ID0ga2V5O1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZXJyb3JLZXkgPyBlcnJvci5oZWFkZXJzLmdldChlcnJvcktleSkgOiBudWxsO1xuICAgIH1cblxufVxuIl19